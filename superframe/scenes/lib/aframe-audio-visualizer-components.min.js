!function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");var i;AFRAME.registerSystem("audio-visualizer",{init:function(){this.analysers={}},getOrCreateAnalyser:function(e){i||(i=new AudioContext);var t=this.analysers,r=i.createAnalyser(),n=e.src,s=n.getAttribute("src");if(t[s])return t[s];var a=i.createMediaElementSource(n);return a.connect(r),r.connect(i.destination),r.smoothingTimeConstant=e.smoothingTimeConstant,r.fftSize=e.fftSize,t[s]=r,t[s]}}),AFRAME.registerComponent("audio-visualizer",{schema:{fftSize:{"default":2048},smoothingTimeConstant:{"default":.8},src:{type:"selector"},unique:{"default":!1}},init:function(){this.analyser=null,this.spectrum=null},update:function(){function e(e){t.analyser=e,t.spectrum=new Uint8Array(t.analyser.frequencyBinCount),t.el.emit("audio-analyser-ready",{analyser:e})}var t=this,i=this.data,r=this.system;i.src&&e(i.unique?r.createAnalyser(i):r.getOrCreateAnalyser(i))},tick:function(){this.analyser&&this.analyser.getByteFrequencyData(this.spectrum)}}),AFRAME.registerComponent("audio-visualizer-kick",{dependencies:["audio-visualizer"],schema:{decay:{"default":.02},frequency:{"default":[0,10]},threshold:{"default":.3}},init:function(){this.currentThreshold=this.data.threshold,this.kicking=!1},tick:function(){var e=this.data,t=this.el;if(t.components["audio-visualizer"].spectrum){var i=this.maxAmplitude(e.frequency);if(i>this.currentThreshold&&i>e.threshold){if(this.kicking)return;this.kicking=!0,t.emit("audio-visualizer-kick-start",{currentThreshold:this.currentThreshold,magnitude:i})}else this.currentThreshold-=e.decay,this.kicking&&(this.kicking=!1,t.emit("audio-visualizer-kick-end",{currentThreshold:this.currentThreshold,magnitude:i}))}},maxAmplitude:function(e){var t=0,i=this.el.components["audio-visualizer"].spectrum;if(!e.length)return e<i.length?i[~~e]:null;for(var r=e[0],n=e[1];n>=r;r++)i[r]>t&&(t=i[r]);return t}})}]);