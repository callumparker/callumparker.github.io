!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=7)}([function(t,e,i){!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){window.download=i(1),window.GIF=i(2).GIF;var n=i(3);if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("camera-recorder",{dependencies:["camera"],schema:{dur:{default:3e3},enabled:{default:!0},framerate:{default:60},lookAt:{type:"vec3"},holdTimeAfter:{default:250},motionBlurEnabled:{default:!0},name:{default:""},quality:{default:10},positionFrom:{type:"vec3"},positionTo:{type:"vec3"},rotationFrom:{type:"vec3"},rotationTo:{type:"vec3"},showControls:{default:!0},workers:{default:8},workerPath:{default:"./"}},multiple:!0,init:function(){var t=this.data;this.startRecordingBound=(()=>{this.startRecording(!1)}),this.startPreviewingBound=(()=>{this.startRecording(!0)}),this.data.showControls&&(this.injectRecordButton(),this.injectDryRunButton()),this.capture=new n({format:"gif",name:t.name||void 0,motionBlurFrames:t.motionBlurEnabled?1:0,onProgress:t=>{this.el.emit("camerarecorderprogress",t,!1)},quality:t.quality,workers:t.workers,workersPath:t.workerPath}),this.lookAt=new THREE.Vector3,this.originalPosition=new THREE.Vector3,this.originalQuaternion=new THREE.Quaternion,this.originalCameraPosition=new THREE.Vector3,this.originalCameraQuaternion=new THREE.Quaternion},update:function(){var t,e=this.data,i=this.el;this.time=0,"positionTo"in(t=this.el.getDOMAttribute("camera-recorder"))&&i.setAttribute("animation__recorderposition",{property:"position",dur:e.dur,easing:"linear",from:"positionFrom"in t?e.positionFrom:i.getAttribute("position"),startEvents:"camerarecorderanimationstart",pauseEvents:"camerarecorderanimationstop",to:e.positionTo}),"rotationTo"in t&&i.setAttribute("animation__recorderrotation",{property:"rotation",dur:e.dur,easing:"linear",from:"rotationFrom"in t?e.rotationFrom:i.getAttribute("rotation"),startEvents:"camerarecorderanimationstart",pauseEvents:"camerarecorderanimationstop",to:e.rotationTo}),"lookAt"in t&&this.lookAt.copy(e.lookAt)},play:function(){var t=this.el;t.addEventListener("camerarecorderstart",this.startRecordingBound),t.addEventListener("camerarecorderdrystart",this.startPreviewingBound),t.hasAttribute("look-controls")&&t.getAttribute("look-controls").enabled&&(t.setAttribute("look-controls","enabled",!1),this.flippedLookControls=!0),t.hasAttribute("orbit-controls")&&t.getAttribute("orbit-controls").enabled&&(t.setAttribute("orbit-controls","enabled",!1),this.flippedOrbitControls=!0),this.resetPose()},remove:function(){var t=this.el;t.emit("camerarecorderanimationstop",null,!1),t.removeEventListener("camerarecorderstart",this.startRecordingBound),t.removeEventListener("camerarecorderdrystart",this.startPreviewingBound),this.flippedLookControls&&t.setAttribute("look-controls","enabled",!0),this.flippedOrbitControls&&t.setAttribute("orbit-controls","enabled",!0),setTimeout(()=>{t.object3D.position.copy(this.originalPosition),t.object3D.quaternion.copy(this.originalQuaternion),t.getObject3D("camera").position.copy(this.originalCameraPosition),t.getObject3D("camera").quaternion.copy(this.originalCameraQuaternion)})},tick:function(){(this.isRecording||this.isPreviewing)&&this.lookAt&&this.el.object3D.lookAt(this.lookAt)},tock:function(t,e){if(this.isRecording||this.isPreviewing){if(this.time+=e,this.time>this.data.dur+this.data.holdTimeAfter)return this.time=0,setTimeout(()=>{this.resetPose()},this.data.holdTimeAfter+100),this.isPreviewing?void(this.isPreviewing=!1):(this.isRecording=!1,this.capture.stop(),this.capture.save(),void(this.recordButton&&(this.recordButton.setAttribute("disabled",""),this.recordButton.innerHTML="Processing...")));this.isRecording&&this.capture.capture(this.el.sceneEl.canvas)}},resetPose:function(){this.originalPosition.copy(this.el.object3D.position),this.originalQuaternion.copy(this.el.object3D.quaternion),this.originalCameraPosition.copy(this.el.getObject3D("camera").position),this.originalCameraQuaternion.copy(this.el.getObject3D("camera").quaternion)},startRecording:function(t){this.el.emit("camerarecorderanimationstart"),this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),setTimeout(()=>{"lookAt"in this.el.getDOMAttribute("camera-recorder")&&(this.el.getObject3D("camera").rotation.y=Math.PI),t?this.isPreviewing=!0:(this.capture.start(),this.isRecording=!0)})},injectRecordButton:function(){var t;(t=document.createElement("button")).innerHTML="Start recording",t.style.left="5px",t.style.position="fixed",t.style.top="5px",t.style.zIndex=999999999999,document.body.appendChild(t),t.addEventListener("click",()=>{this.startRecording()}),this.recordButton=t},injectDryRunButton:function(){var t;(t=document.createElement("button")).innerHTML="Preview recording",t.style.left="5px",t.style.position="fixed",t.style.top="30px",t.style.zIndex=999999999999,document.body.appendChild(t),t.addEventListener("click",()=>{this.startRecording(!0)})}})},function(t,e){t.exports=function(t,e,i){var n,r,o,s=window,a="application/octet-stream",h=i||a,c=t,l=document,u=l.createElement("a"),p=function(t){return String(t)},d=s.Blob||s.MozBlob||s.WebKitBlob||p,f=s.MSBlobBuilder||s.WebKitBlobBuilder||s.BlobBuilder,m=e||"download";if("true"===String(this)&&(h=(c=[c,h])[0],c=c[1]),String(c).match(/^data\:[\w+\-]+\/[\w+\-]+[,;]/))return navigator.msSaveBlob?navigator.msSaveBlob(function(t){var e=t.split(/[:;,]/),i=e[1],n=("base64"==e[2]?atob:decodeURIComponent)(e.pop()),r=n.length,o=0,s=new Uint8Array(r);for(;o<r;++o)s[o]=n.charCodeAt(o);return new d([s],{type:i})}(c),m):g(c);try{n=c instanceof d?c:new d([c],{type:h})}catch(t){f&&((r=new f).append([c]),n=r.getBlob(h))}function g(t,e){if("download"in u)return u.href=t,u.setAttribute("download",m),u.innerHTML="downloading...",u.style.display="none",l.body.appendChild(u),setTimeout(function(){u.click(),l.body.removeChild(u),!0===e&&setTimeout(function(){s.URL.revokeObjectURL(u.href)},250)},66),!0;var i=l.createElement("iframe");l.body.appendChild(i),e||(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,a)),i.src=t,setTimeout(function(){l.body.removeChild(i)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(n,m);if(s.URL)g(s.URL.createObjectURL(n),!0);else{if("string"==typeof n||n.constructor===p)try{return g("data:"+h+";base64,"+s.btoa(n))}catch(t){return g("data:"+h+","+encodeURIComponent(n))}(o=new FileReader).onload=function(t){g(this.result)},o.readAsDataURL(n)}return!0}},function(t,e){(function(t){function e(t,i){if({}.hasOwnProperty.call(e.cache,t))return e.cache[t];var n=e.resolve(t);if(!n)throw new Error("Failed to resolve module "+t);var r={id:t,require:e,filename:t,exports:{},loaded:!1,parent:i,children:[]};i&&i.children.push(r);var o=t.slice(0,t.lastIndexOf("/")+1);return e.cache[t]=r.exports,n.call(r.exports,r,r.exports,o,t),r.loaded=!0,e.cache[t]=r.exports}e.modules={},e.cache={},e.resolve=function(t){return{}.hasOwnProperty.call(e.modules,t)?e.modules[t]:void 0},e.define=function(t,i){e.modules[t]=i};var i=function(e){return e="/",{title:"browser",version:"v0.10.26",browser:!0,env:{},argv:[],nextTick:t.setImmediate||function(t){setTimeout(t,0)},cwd:function(){return e},chdir:function(t){e=t}}}();e.define("/gif.coffee",function(t,i,n,r){function o(t,e){return{}.hasOwnProperty.call(t,e)}var s,a,h,c,l;h=e("events",t).EventEmitter,s=e("/browser.coffee",t),l=function(t){function e(t){var e,i;for(e in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(t),a)i=a[e],null!=this.options[e]?this.options[e]:this.options[e]=i}return function(t,e){function i(){this.constructor=t}for(var n in e)o(e,n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,h),a={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null},c={delay:500,copy:!1},e.prototype.setOption=function(t,e){return this.options[t]=e,null==this._canvas||"width"!==t&&"height"!==t?void 0:this._canvas[t]=e},e.prototype.setOptions=function(t){var e,i;return function(n){for(e in t)o(t,e)&&(i=t[e],n.push(this.setOption(e,i)));return n}.call(this,[])},e.prototype.addFrame=function(t,e){var i,n;for(n in null==e&&(e={}),(i={}).transparent=this.options.transparent,c)i[n]=e[n]||c[n];if(null!=this.options.width||this.setOption("width",t.width),null!=this.options.height||this.setOption("height",t.height),"undefined"!=typeof ImageData&&null!=ImageData&&t instanceof ImageData)i.data=t.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&t instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&t instanceof WebGLRenderingContext)e.copy?i.data=this.getContextData(t):i.context=t;else{if(null==t.childNodes)throw new Error("Invalid image");e.copy?i.data=this.getImageData(t):i.image=t}return this.frames.push(i)},e.prototype.render=function(){var t;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(t){for(var e=function(){var t;t=[];for(var e=0;0<=this.frames.length?e<this.frames.length:e>this.frames.length;0<=this.frames.length?++e:--e)t.push(e);return t}.apply(this,arguments),i=0,n=e.length;i<n;++i)e[i],t.push(null);return t}.call(this,[]),t=this.spawnWorkers();for(var e=function(){var e;e=[];for(var i=0;0<=t?i<t:i>t;0<=t?++i:--i)e.push(i);return e}.apply(this,arguments),i=0,n=e.length;i<n;++i)e[i],this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},e.prototype.abort=function(){for(var t;null!=(t=this.activeWorkers.shift());)console.log("killing active worker"),t.terminate();return this.running=!1,this.emit("abort")},e.prototype.spawnWorkers=function(){var t;return t=Math.min(this.options.workers,this.frames.length),function(){var e;e=[];for(var i=this.freeWorkers.length;this.freeWorkers.length<=t?i<t:i>t;this.freeWorkers.length<=t?++i:--i)e.push(i);return e}.apply(this,arguments).forEach(function(t){return function(e){var i;return console.log("spawning worker "+e),(i=new Worker(t.options.workerScript)).onmessage=function(t){return function(e){return t.activeWorkers.splice(t.activeWorkers.indexOf(i),1),t.freeWorkers.push(i),t.frameFinished(e.data)}}(t),t.freeWorkers.push(i)}}(this)),t},e.prototype.frameFinished=function(t){return console.log("frame "+t.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[t.index]=t,function(t,e){for(var i=0,n=e.length;i<n;++i)if(i in e&&e[i]===t)return!0;return!1}(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},e.prototype.finishRendering=function(){var t,e,i,n,r,o,s;r=0;for(var a=0,h=this.imageParts.length;a<h;++a)r+=((e=this.imageParts[a]).data.length-1)*e.pageSize+e.cursor;r+=e.pageSize-e.cursor,console.log("rendering finished - filesize "+Math.round(r/1e3)+"kb"),t=new Uint8Array(r),o=0;for(var c=0,l=this.imageParts.length;c<l;++c)for(var u=0,p=(e=this.imageParts[c]).data.length;u<p;++u)s=e.data[u],i=u,t.set(s,o),i===e.data.length-1?o+=e.cursor:o+=e.pageSize;return n=new Blob([t],{type:"image/gif"}),this.emit("finished",n,t)},e.prototype.renderNextFrame=function(){var t,e,i;if(0===this.freeWorkers.length)throw new Error("No free workers");return this.nextFrame>=this.frames.length?void 0:(t=this.frames[this.nextFrame++],i=this.freeWorkers.shift(),e=this.getTask(t),console.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(i),i.postMessage(e))},e.prototype.getContextData=function(t){return t.getImageData(0,0,this.options.width,this.options.height).data},e.prototype.getImageData=function(t){var e;return null!=this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(e=this._canvas.getContext("2d")).setFill=this.options.background,e.fillRect(0,0,this.options.width,this.options.height),e.drawImage(t,0,0),this.getContextData(e)},e.prototype.getTask=function(t){var e,i;if(i={index:e=this.frames.indexOf(t),last:e===this.frames.length-1,delay:t.delay,transparent:t.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,repeat:this.options.repeat,canTransfer:"chrome"===s.name},null!=t.data)i.data=t.data;else if(null!=t.context)i.data=this.getContextData(t.context);else{if(null==t.image)throw new Error("Invalid frame");i.data=this.getImageData(t.image)}return i},e}(),t.exports=l}),e.define("/browser.coffee",function(t,e,i,n){var r,o,s,a,h;a=navigator.userAgent.toLowerCase(),s=navigator.platform.toLowerCase(),o="ie"===(h=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0])[1]&&document.documentMode,(r={name:"version"===h[1]?h[3]:h[1],version:o||parseFloat("opera"===h[1]&&h[4]?h[4]:h[2]),platform:{name:a.match(/ip(?:ad|od|hone)/)?"ios":(a.match(/(?:webos|android)/)||s.match(/mac|win|linux/)||["other"])[0]}})[r.name]=!0,r[r.name+parseInt(r.version,10)]=!0,r.platform[r.platform.name]=!0,t.exports=r}),e.define("events",function(t,e,n,r){i.EventEmitter||(i.EventEmitter=function(){});var o=e.EventEmitter=i.EventEmitter,s="function"==typeof Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};o.prototype.setMaxListeners=function(t){this._events||(this._events={}),this._events.maxListeners=t},o.prototype.emit=function(t){if("error"===t&&(!this._events||!this._events.error||s(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var e=this._events[t];if(!e)return!1;if("function"!=typeof e){if(s(e)){for(var i=Array.prototype.slice.call(arguments,1),n=e.slice(),r=0,o=n.length;r<o;r++)n[r].apply(this,i);return!0}return!1}switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1);e.apply(this,i)}return!0},o.prototype.addListener=function(t,e){if("function"!=typeof e)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",t,e),this._events[t])if(s(this._events[t])){var i;if(!this._events[t].warned)(i=void 0!==this._events.maxListeners?this._events.maxListeners:10)&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace());this._events[t].push(e)}else this._events[t]=[this._events[t],e];else this._events[t]=e;return this},o.prototype.on=o.prototype.addListener,o.prototype.once=function(t,e){var i=this;return i.on(t,function n(){i.removeListener(t,n),e.apply(this,arguments)}),this},o.prototype.removeListener=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var i=this._events[t];if(s(i)){var n=i.indexOf(e);if(n<0)return this;i.splice(n,1),0==i.length&&delete this._events[t]}else this._events[t]===e&&delete this._events[t];return this},o.prototype.removeAllListeners=function(t){return t&&this._events&&this._events[t]&&(this._events[t]=null),this},o.prototype.listeners=function(t){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),s(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]}}),t.GIF=e("/gif.coffee")}).call(this,this)},function(t,e,i){(function(t,n){var r;!function(){"use strict";var o={function:!0,object:!0};function s(t){return t&&t.Object===Object?t:null}parseFloat,parseInt;var a=o[typeof e]&&e&&!e.nodeType?e:void 0,h=o[typeof t]&&t&&!t.nodeType?t:void 0,c=(h&&h.exports,s(a&&h&&"object"==typeof n&&n)),l=s(o[typeof self]&&self),u=s(o[typeof window]&&window),p=s(o[typeof this]&&this);c||u!==(p&&p.window)&&u||l||p||Function("return this")();function d(t){return String("0000000"+t).slice(-7)}"gc"in window||(window.gc=function(){}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){for(var n=atob(this.toDataURL(e,i).split(",")[1]),r=n.length,o=new Uint8Array(r),s=0;s<r;s++)o[s]=n.charCodeAt(s);t(new Blob([o],{type:e||"image/png"}))}}),
// @license http://opensource.org/licenses/MIT
function(){if("performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-t}}}();var f=window.Date.now();function m(t){var e={};this.settings=t,this.on=function(t,i){e[t]=i},this.emit=function(t){var i=e[t];i&&i.apply(null,Array.prototype.slice.call(arguments,1))},this.filename=t.name||function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}(),this.extension="",this.mimeType=""}function g(t){m.call(this,t),this.extension=".tar",this.mimeType="application/x-tar",this.fileExtension="",this.baseFilename=this.filename,this.tape=null,this.count=0,this.part=1,this.frames=0}function v(t){g.call(this,t),this.type="image/png",this.fileExtension=".png"}function w(t){g.call(this,t),this.type="image/jpeg",this.fileExtension=".jpg",this.quality=t.quality/100||.8}function y(t){"image/webp"!==document.createElement("canvas").toDataURL("image/webp").substr(5,10)&&console.log("WebP not supported - try another export format"),m.call(this,t),this.quality=t.quality/100||.8,this.extension=".webm",this.mimeType="video/webm",this.baseFilename=this.filename,this.framerate=t.framerate,this.frames=0,this.part=1,this.videoWriter=new WebMWriter({quality:this.quality,fileWriter:null,fd:null,frameRate:this.framerate})}function b(t){m.call(this,t),t.quality=t.quality/100||.8,this.encoder=new FFMpegServer.Video(t),this.encoder.on("process",function(){this.emit("process")}.bind(this)),this.encoder.on("finished",function(t,e){var i=this.callback;i&&(this.callback=void 0,i(t,e))}.bind(this)),this.encoder.on("progress",function(t){this.settings.onProgress&&this.settings.onProgress(t)}.bind(this)),this.encoder.on("error",function(t){alert(JSON.stringify(t,null,2))}.bind(this))}function k(t){m.call(this,t),this.framerate=this.settings.framerate,this.type="video/webm",this.extension=".webm",this.stream=null,this.mediaRecorder=null,this.chunks=[]}function x(t){m.call(this,t),t.quality=31-(30*t.quality/100||10),t.workers=t.workers||4,this.extension=".gif",this.mimeType="image/gif",this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.sizeSet=!1,this.encoder=new GIF({workers:t.workers,quality:t.quality,workerScript:t.workersPath+"gif.worker.js"}),this.encoder.on("progress",function(t){this.settings.onProgress&&this.settings.onProgress(t)}.bind(this)),this.encoder.on("finished",function(t){var e=this.callback;e&&(this.callback=void 0,e(t))}.bind(this))}function T(t){var e,i,n,r,o,s,a,h=t||{},c=(new Date,[]),l=[],u=0,p=0,d=[],m=!1,g={};h.framerate=h.framerate||60,h.motionBlurFrames=2*(h.motionBlurFrames||1),e=h.verbose||!1,h.display,h.step=1e3/h.framerate,h.timeLimit=h.timeLimit||0,h.frameLimit=h.frameLimit||0,h.startTime=h.startTime||0;var T=document.createElement("div");T.style.position="absolute",T.style.left=T.style.top=0,T.style.backgroundColor="black",T.style.fontFamily="monospace",T.style.fontSize="11px",T.style.padding="5px",T.style.color="red",T.style.zIndex=1e5,h.display&&document.body.appendChild(T);var E,F,_=document.createElement("canvas"),A=_.getContext("2d");Q("Step is set to "+h.step+"ms");var C={gif:x,webm:y,ffmpegserver:b,png:v,jpg:w,"webm-mediarecorder":k},R=C[h.format];if(!R)throw"Error: Incorrect or missing format: Valid formats are "+Object.keys(C).join(", ");if((a=new R(h)).step=s,a.on("process",H),a.on("progress",function(t){!function(t){var e=g[t];e&&e.apply(null,Array.prototype.slice.call(arguments,1))}("progress",t)}),"performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var D=Date.now();performance.timing&&performance.timing.navigationStart&&(D=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-D}}var P=window.setTimeout,L=window.setInterval,O=window.clearInterval,B=window.clearTimeout,j=window.requestAnimationFrame,S=window.Date.now,I=window.performance.now,W=window.Date.prototype.getTime,M=[];function q(){m=!1,a.stop(),Q("Capturer stop"),window.setTimeout=P,window.setInterval=L,window.clearInterval=O,window.clearTimeout=B,window.requestAnimationFrame=j,window.Date.prototype.getTime=W,window.Date.now=S,window.performance.now=I}function U(t,e){P(t,0,e)}function s(){U(H)}function H(){var t=1e3/h.framerate,e=(u+p/h.motionBlurFrames)*t;i=n+e,r=o+e,M.forEach(function(t){t._hookedTime=e/1e3}),function(){var t=u/h.framerate;(h.frameLimit&&u>=h.frameLimit||h.timeLimit&&t>=h.timeLimit)&&(q(),z());var e=new Date(null);e.setSeconds(t),h.motionBlurFrames>2?T.textContent="CCapture "+h.format+" | "+u+" frames ("+p+" inter) | "+e.toISOString().substr(11,8):T.textContent="CCapture "+h.format+" | "+u+" frames | "+e.toISOString().substr(11,8)}(),Q("Frame: "+u+" "+p);for(var s=0;s<c.length;s++)i>=c[s].triggerTime&&(U(c[s].callback),c.splice(s,1));for(s=0;s<l.length;s++)i>=l[s].triggerTime&&(U(l[s].callback),l[s].triggerTime+=l[s].time);d.forEach(function(t){U(t,i-f)}),d=[]}function z(t){t||(t=function(t){return download(t,a.filename+a.extension,a.mimeType),!1}),a.save(t)}function Q(t){e&&console.log(t)}return{start:function(){!function(){function t(){return this._hooked||(this._hooked=!0,this._hookedTime=this.currentTime||0,this.pause(),M.push(this)),this._hookedTime+h.startTime}Q("Capturer start"),n=window.Date.now(),i=n+h.startTime,o=window.performance.now(),r=o+h.startTime,window.Date.prototype.getTime=function(){return i},window.Date.now=function(){return i},window.setTimeout=function(t,e){var n={callback:t,time:e,triggerTime:i+e};return c.push(n),Q("Timeout set to "+n.time),n},window.clearTimeout=function(t){for(var e=0;e<c.length;e++)c[e]!=t||(c.splice(e,1),Q("Timeout cleared"))},window.setInterval=function(t,e){var n={callback:t,time:e,triggerTime:i+e};return l.push(n),Q("Interval set to "+n.time),n},window.clearInterval=function(t){return Q("clear Interval"),null},window.requestAnimationFrame=function(t){d.push(t)},window.performance.now=function(){return r};try{Object.defineProperty(HTMLVideoElement.prototype,"currentTime",{get:t}),Object.defineProperty(HTMLAudioElement.prototype,"currentTime",{get:t})}catch(t){Q(t)}}(),a.start(),m=!0},capture:function(t){m&&(h.motionBlurFrames>2?(function(t){_.width===t.width&&_.height===t.height||(_.width=t.width,_.height=t.height,E=new Uint16Array(_.height*_.width*4),A.fillStyle="#0",A.fillRect(0,0,_.width,_.height))}(t),function(t){A.drawImage(t,0,0),F=A.getImageData(0,0,_.width,_.height);for(var e=0;e<E.length;e+=4)E[e]+=F.data[e],E[e+1]+=F.data[e+1],E[e+2]+=F.data[e+2];p++}(t),p>=.5*h.motionBlurFrames?function(){for(var t=F.data,e=0;e<E.length;e+=4)t[e]=2*E[e]/h.motionBlurFrames,t[e+1]=2*E[e+1]/h.motionBlurFrames,t[e+2]=2*E[e+2]/h.motionBlurFrames;for(A.putImageData(F,0,0),a.add(_),p=0,Q("Full MB Frame! "+ ++u+" "+i),e=0;e<E.length;e+=4)E[e]=0,E[e+1]=0,E[e+2]=0;gc()}():s()):(a.add(t),Q("Full Frame! "+ ++u)))},stop:q,save:z,on:function(t,e){g[t]=e}}}m.prototype.start=function(){},m.prototype.stop=function(){},m.prototype.add=function(){},m.prototype.save=function(){},m.prototype.dispose=function(){},m.prototype.safeToProceed=function(){return!0},m.prototype.step=function(){console.log("Step not set!")},g.prototype=Object.create(m.prototype),g.prototype.start=function(){this.dispose()},g.prototype.add=function(t){var e=new FileReader;e.onload=function(){this.tape.append(d(this.count)+this.fileExtension,new Uint8Array(e.result)),this.settings.autoSaveTime>0&&this.frames/this.settings.framerate>=this.settings.autoSaveTime?this.save(function(t){this.filename=this.baseFilename+"-part-"+d(this.part),download(t,this.filename+this.extension,this.mimeType);var e=this.count;this.dispose(),this.count=e+1,this.part++,this.filename=this.baseFilename+"-part-"+d(this.part),this.frames=0,this.step()}.bind(this)):(this.count++,this.frames++,this.step())}.bind(this),e.readAsArrayBuffer(t)},g.prototype.save=function(t){t(this.tape.save())},g.prototype.dispose=function(){this.tape=new Tar,this.count=0},v.prototype=Object.create(g.prototype),v.prototype.add=function(t){t.toBlob(function(t){g.prototype.add.call(this,t)}.bind(this),this.type)},w.prototype=Object.create(g.prototype),w.prototype.add=function(t){t.toBlob(function(t){g.prototype.add.call(this,t)}.bind(this),this.type,this.quality)},y.prototype=Object.create(m.prototype),y.prototype.start=function(t){this.dispose()},y.prototype.add=function(t){this.videoWriter.addFrame(t),this.settings.autoSaveTime>0&&this.frames/this.settings.framerate>=this.settings.autoSaveTime?this.save(function(t){this.filename=this.baseFilename+"-part-"+d(this.part),download(t,this.filename+this.extension,this.mimeType),this.dispose(),this.part++,this.filename=this.baseFilename+"-part-"+d(this.part),this.step()}.bind(this)):(this.frames++,this.step())},y.prototype.save=function(t){this.videoWriter.complete().then(t)},y.prototype.dispose=function(t){this.frames=0,this.videoWriter=new WebMWriter({quality:this.quality,fileWriter:null,fd:null,frameRate:this.framerate})},b.prototype=Object.create(m.prototype),b.prototype.start=function(){this.encoder.start(this.settings)},b.prototype.add=function(t){this.encoder.add(t)},b.prototype.save=function(t){this.callback=t,this.encoder.end()},b.prototype.safeToProceed=function(){return this.encoder.safeToProceed()},k.prototype=Object.create(m.prototype),k.prototype.add=function(t){this.stream||(this.stream=t.captureStream(this.framerate),this.mediaRecorder=new MediaRecorder(this.stream),this.mediaRecorder.start(),this.mediaRecorder.ondataavailable=function(t){this.chunks.push(t.data)}.bind(this)),this.step()},k.prototype.save=function(t){this.mediaRecorder.onstop=function(e){var i=new Blob(this.chunks,{type:"video/webm"});this.chunks=[],t(i)}.bind(this),this.mediaRecorder.stop()},x.prototype=Object.create(m.prototype),x.prototype.add=function(t){this.sizeSet||(this.encoder.setOption("width",t.width),this.encoder.setOption("height",t.height),this.sizeSet=!0),this.canvas.width=t.width,this.canvas.height=t.height,this.ctx.drawImage(t,0,0),this.encoder.addFrame(this.ctx,{copy:!0,delay:this.settings.step}),this.step()},x.prototype.save=function(t){this.callback=t,this.encoder.render()},(u||l||{}).CCapture=T,void 0===(r=function(){return T}.call(e,i,e,t))||(t.exports=r)}()}).call(e,i(4)(t),i(5))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i}])},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,i){(function(t,n){var r;!function(){"use strict";var o={function:!0,object:!0};function s(t){return t&&t.Object===Object?t:null}parseFloat,parseInt;var a=o[typeof e]&&e&&!e.nodeType?e:void 0,h=o[typeof t]&&t&&!t.nodeType?t:void 0,c=(h&&h.exports,s(a&&h&&"object"==typeof n&&n)),l=s(o[typeof self]&&self),u=s(o[typeof window]&&window),p=s(o[typeof this]&&this);c||u!==(p&&p.window)&&u||l||p||Function("return this")();function d(t){return String("0000000"+t).slice(-7)}"gc"in window||(window.gc=function(){}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){for(var n=atob(this.toDataURL(e,i).split(",")[1]),r=n.length,o=new Uint8Array(r),s=0;s<r;s++)o[s]=n.charCodeAt(s);t(new Blob([o],{type:e||"image/png"}))}}),
// @license http://opensource.org/licenses/MIT
function(){if("performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-t}}}();var f=window.Date.now();function m(t){var e={};this.settings=t,this.on=function(t,i){e[t]=i},this.emit=function(t){var i=e[t];i&&i.apply(null,Array.prototype.slice.call(arguments,1))},this.filename=t.name||function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}(),this.extension="",this.mimeType=""}function g(t){m.call(this,t),this.extension=".tar",this.mimeType="application/x-tar",this.fileExtension="",this.baseFilename=this.filename,this.tape=null,this.count=0,this.part=1,this.frames=0}function v(t){g.call(this,t),this.type="image/png",this.fileExtension=".png"}function w(t){g.call(this,t),this.type="image/jpeg",this.fileExtension=".jpg",this.quality=t.quality/100||.8}function y(t){"image/webp"!==document.createElement("canvas").toDataURL("image/webp").substr(5,10)&&console.log("WebP not supported - try another export format"),m.call(this,t),this.quality=t.quality/100||.8,this.extension=".webm",this.mimeType="video/webm",this.baseFilename=this.filename,this.framerate=t.framerate,this.frames=0,this.part=1,this.videoWriter=new WebMWriter({quality:this.quality,fileWriter:null,fd:null,frameRate:this.framerate})}function b(t){m.call(this,t),t.quality=t.quality/100||.8,this.encoder=new FFMpegServer.Video(t),this.encoder.on("process",function(){this.emit("process")}.bind(this)),this.encoder.on("finished",function(t,e){var i=this.callback;i&&(this.callback=void 0,i(t,e))}.bind(this)),this.encoder.on("progress",function(t){this.settings.onProgress&&this.settings.onProgress(t)}.bind(this)),this.encoder.on("error",function(t){alert(JSON.stringify(t,null,2))}.bind(this))}function k(t){m.call(this,t),this.framerate=this.settings.framerate,this.type="video/webm",this.extension=".webm",this.stream=null,this.mediaRecorder=null,this.chunks=[]}function x(t){m.call(this,t),t.quality=31-(30*t.quality/100||10),t.workers=t.workers||4,this.extension=".gif",this.mimeType="image/gif",this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.sizeSet=!1,this.encoder=new GIF({workers:t.workers,quality:t.quality,workerScript:t.workersPath+"gif.worker.js"}),this.encoder.on("progress",function(t){this.settings.onProgress&&this.settings.onProgress(t)}.bind(this)),this.encoder.on("finished",function(t){var e=this.callback;e&&(this.callback=void 0,e(t))}.bind(this))}function T(t){var e,i,n,r,o,s,a,h=t||{},c=(new Date,[]),l=[],u=0,p=0,d=[],m=!1,g={};h.framerate=h.framerate||60,h.motionBlurFrames=2*(h.motionBlurFrames||1),e=h.verbose||!1,h.display,h.step=1e3/h.framerate,h.timeLimit=h.timeLimit||0,h.frameLimit=h.frameLimit||0,h.startTime=h.startTime||0;var T=document.createElement("div");T.style.position="absolute",T.style.left=T.style.top=0,T.style.backgroundColor="black",T.style.fontFamily="monospace",T.style.fontSize="11px",T.style.padding="5px",T.style.color="red",T.style.zIndex=1e5,h.display&&document.body.appendChild(T);var E,F,_=document.createElement("canvas"),A=_.getContext("2d");Q("Step is set to "+h.step+"ms");var C={gif:x,webm:y,ffmpegserver:b,png:v,jpg:w,"webm-mediarecorder":k},R=C[h.format];if(!R)throw"Error: Incorrect or missing format: Valid formats are "+Object.keys(C).join(", ");if((a=new R(h)).step=s,a.on("process",H),a.on("progress",function(t){!function(t){var e=g[t];e&&e.apply(null,Array.prototype.slice.call(arguments,1))}("progress",t)}),"performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var D=Date.now();performance.timing&&performance.timing.navigationStart&&(D=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-D}}var P=window.setTimeout,L=window.setInterval,O=window.clearInterval,B=window.clearTimeout,j=window.requestAnimationFrame,S=window.Date.now,I=window.performance.now,W=window.Date.prototype.getTime,M=[];function q(){m=!1,a.stop(),Q("Capturer stop"),window.setTimeout=P,window.setInterval=L,window.clearInterval=O,window.clearTimeout=B,window.requestAnimationFrame=j,window.Date.prototype.getTime=W,window.Date.now=S,window.performance.now=I}function U(t,e){P(t,0,e)}function s(){U(H)}function H(){var t=1e3/h.framerate,e=(u+p/h.motionBlurFrames)*t;i=n+e,r=o+e,M.forEach(function(t){t._hookedTime=e/1e3}),function(){var t=u/h.framerate;(h.frameLimit&&u>=h.frameLimit||h.timeLimit&&t>=h.timeLimit)&&(q(),z());var e=new Date(null);e.setSeconds(t),h.motionBlurFrames>2?T.textContent="CCapture "+h.format+" | "+u+" frames ("+p+" inter) | "+e.toISOString().substr(11,8):T.textContent="CCapture "+h.format+" | "+u+" frames | "+e.toISOString().substr(11,8)}(),Q("Frame: "+u+" "+p);for(var s=0;s<c.length;s++)i>=c[s].triggerTime&&(U(c[s].callback),c.splice(s,1));for(s=0;s<l.length;s++)i>=l[s].triggerTime&&(U(l[s].callback),l[s].triggerTime+=l[s].time);d.forEach(function(t){U(t,i-f)}),d=[]}function z(t){t||(t=function(t){return download(t,a.filename+a.extension,a.mimeType),!1}),a.save(t)}function Q(t){e&&console.log(t)}return{start:function(){!function(){function t(){return this._hooked||(this._hooked=!0,this._hookedTime=this.currentTime||0,this.pause(),M.push(this)),this._hookedTime+h.startTime}Q("Capturer start"),n=window.Date.now(),i=n+h.startTime,o=window.performance.now(),r=o+h.startTime,window.Date.prototype.getTime=function(){return i},window.Date.now=function(){return i},window.setTimeout=function(t,e){var n={callback:t,time:e,triggerTime:i+e};return c.push(n),Q("Timeout set to "+n.time),n},window.clearTimeout=function(t){for(var e=0;e<c.length;e++)c[e]!=t||(c.splice(e,1),Q("Timeout cleared"))},window.setInterval=function(t,e){var n={callback:t,time:e,triggerTime:i+e};return l.push(n),Q("Interval set to "+n.time),n},window.clearInterval=function(t){return Q("clear Interval"),null},window.requestAnimationFrame=function(t){d.push(t)},window.performance.now=function(){return r};try{Object.defineProperty(HTMLVideoElement.prototype,"currentTime",{get:t}),Object.defineProperty(HTMLAudioElement.prototype,"currentTime",{get:t})}catch(t){Q(t)}}(),a.start(),m=!0},capture:function(t){m&&(h.motionBlurFrames>2?(function(t){_.width===t.width&&_.height===t.height||(_.width=t.width,_.height=t.height,E=new Uint16Array(_.height*_.width*4),A.fillStyle="#0",A.fillRect(0,0,_.width,_.height))}(t),function(t){A.drawImage(t,0,0),F=A.getImageData(0,0,_.width,_.height);for(var e=0;e<E.length;e+=4)E[e]+=F.data[e],E[e+1]+=F.data[e+1],E[e+2]+=F.data[e+2];p++}(t),p>=.5*h.motionBlurFrames?function(){for(var t=F.data,e=0;e<E.length;e+=4)t[e]=2*E[e]/h.motionBlurFrames,t[e+1]=2*E[e+1]/h.motionBlurFrames,t[e+2]=2*E[e+2]/h.motionBlurFrames;for(A.putImageData(F,0,0),a.add(_),p=0,Q("Full MB Frame! "+ ++u+" "+i),e=0;e<E.length;e+=4)E[e]=0,E[e+1]=0,E[e+2]=0;gc()}():s()):(a.add(t),Q("Full Frame! "+ ++u)))},stop:q,save:z,on:function(t,e){g[t]=e}}}m.prototype.start=function(){},m.prototype.stop=function(){},m.prototype.add=function(){},m.prototype.save=function(){},m.prototype.dispose=function(){},m.prototype.safeToProceed=function(){return!0},m.prototype.step=function(){console.log("Step not set!")},g.prototype=Object.create(m.prototype),g.prototype.start=function(){this.dispose()},g.prototype.add=function(t){var e=new FileReader;e.onload=function(){this.tape.append(d(this.count)+this.fileExtension,new Uint8Array(e.result)),this.settings.autoSaveTime>0&&this.frames/this.settings.framerate>=this.settings.autoSaveTime?this.save(function(t){this.filename=this.baseFilename+"-part-"+d(this.part),download(t,this.filename+this.extension,this.mimeType);var e=this.count;this.dispose(),this.count=e+1,this.part++,this.filename=this.baseFilename+"-part-"+d(this.part),this.frames=0,this.step()}.bind(this)):(this.count++,this.frames++,this.step())}.bind(this),e.readAsArrayBuffer(t)},g.prototype.save=function(t){t(this.tape.save())},g.prototype.dispose=function(){this.tape=new Tar,this.count=0},v.prototype=Object.create(g.prototype),v.prototype.add=function(t){t.toBlob(function(t){g.prototype.add.call(this,t)}.bind(this),this.type)},w.prototype=Object.create(g.prototype),w.prototype.add=function(t){t.toBlob(function(t){g.prototype.add.call(this,t)}.bind(this),this.type,this.quality)},y.prototype=Object.create(m.prototype),y.prototype.start=function(t){this.dispose()},y.prototype.add=function(t){this.videoWriter.addFrame(t),this.settings.autoSaveTime>0&&this.frames/this.settings.framerate>=this.settings.autoSaveTime?this.save(function(t){this.filename=this.baseFilename+"-part-"+d(this.part),download(t,this.filename+this.extension,this.mimeType),this.dispose(),this.part++,this.filename=this.baseFilename+"-part-"+d(this.part),this.step()}.bind(this)):(this.frames++,this.step())},y.prototype.save=function(t){this.videoWriter.complete().then(t)},y.prototype.dispose=function(t){this.frames=0,this.videoWriter=new WebMWriter({quality:this.quality,fileWriter:null,fd:null,frameRate:this.framerate})},b.prototype=Object.create(m.prototype),b.prototype.start=function(){this.encoder.start(this.settings)},b.prototype.add=function(t){this.encoder.add(t)},b.prototype.save=function(t){this.callback=t,this.encoder.end()},b.prototype.safeToProceed=function(){return this.encoder.safeToProceed()},k.prototype=Object.create(m.prototype),k.prototype.add=function(t){this.stream||(this.stream=t.captureStream(this.framerate),this.mediaRecorder=new MediaRecorder(this.stream),this.mediaRecorder.start(),this.mediaRecorder.ondataavailable=function(t){this.chunks.push(t.data)}.bind(this)),this.step()},k.prototype.save=function(t){this.mediaRecorder.onstop=function(e){var i=new Blob(this.chunks,{type:"video/webm"});this.chunks=[],t(i)}.bind(this),this.mediaRecorder.stop()},x.prototype=Object.create(m.prototype),x.prototype.add=function(t){this.sizeSet||(this.encoder.setOption("width",t.width),this.encoder.setOption("height",t.height),this.sizeSet=!0),this.canvas.width=t.width,this.canvas.height=t.height,this.ctx.drawImage(t,0,0),this.encoder.addFrame(this.ctx,{copy:!0,delay:this.settings.step}),this.step()},x.prototype.save=function(t){this.callback=t,this.encoder.render()},(u||l||{}).CCapture=T,void 0===(r=function(){return T}.call(e,i,e,t))||(t.exports=r)}()}).call(this,i(2)(t),i(1))},function(t,e){(function(t){function e(t,i){if({}.hasOwnProperty.call(e.cache,t))return e.cache[t];var n=e.resolve(t);if(!n)throw new Error("Failed to resolve module "+t);var r={id:t,require:e,filename:t,exports:{},loaded:!1,parent:i,children:[]};i&&i.children.push(r);var o=t.slice(0,t.lastIndexOf("/")+1);return e.cache[t]=r.exports,n.call(r.exports,r,r.exports,o,t),r.loaded=!0,e.cache[t]=r.exports}e.modules={},e.cache={},e.resolve=function(t){return{}.hasOwnProperty.call(e.modules,t)?e.modules[t]:void 0},e.define=function(t,i){e.modules[t]=i};var i=function(e){return e="/",{title:"browser",version:"v0.10.26",browser:!0,env:{},argv:[],nextTick:t.setImmediate||function(t){setTimeout(t,0)},cwd:function(){return e},chdir:function(t){e=t}}}();e.define("/gif.coffee",function(t,i,n,r){function o(t,e){return{}.hasOwnProperty.call(t,e)}var s,a,h,c,l;h=e("events",t).EventEmitter,s=e("/browser.coffee",t),l=function(t){function e(t){var e,i;for(e in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(t),a)i=a[e],null!=this.options[e]?this.options[e]:this.options[e]=i}return function(t,e){function i(){this.constructor=t}for(var n in e)o(e,n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(e,h),a={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null},c={delay:500,copy:!1},e.prototype.setOption=function(t,e){return this.options[t]=e,null==this._canvas||"width"!==t&&"height"!==t?void 0:this._canvas[t]=e},e.prototype.setOptions=function(t){var e,i;return function(n){for(e in t)o(t,e)&&(i=t[e],n.push(this.setOption(e,i)));return n}.call(this,[])},e.prototype.addFrame=function(t,e){var i,n;for(n in null==e&&(e={}),(i={}).transparent=this.options.transparent,c)i[n]=e[n]||c[n];if(null!=this.options.width||this.setOption("width",t.width),null!=this.options.height||this.setOption("height",t.height),"undefined"!=typeof ImageData&&null!=ImageData&&t instanceof ImageData)i.data=t.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&t instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&t instanceof WebGLRenderingContext)e.copy?i.data=this.getContextData(t):i.context=t;else{if(null==t.childNodes)throw new Error("Invalid image");e.copy?i.data=this.getImageData(t):i.image=t}return this.frames.push(i)},e.prototype.render=function(){var t;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(t){for(var e=function(){var t;t=[];for(var e=0;0<=this.frames.length?e<this.frames.length:e>this.frames.length;0<=this.frames.length?++e:--e)t.push(e);return t}.apply(this,arguments),i=0,n=e.length;i<n;++i)e[i],t.push(null);return t}.call(this,[]),t=this.spawnWorkers();for(var e=function(){var e;e=[];for(var i=0;0<=t?i<t:i>t;0<=t?++i:--i)e.push(i);return e}.apply(this,arguments),i=0,n=e.length;i<n;++i)e[i],this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},e.prototype.abort=function(){for(var t;null!=(t=this.activeWorkers.shift());)console.log("killing active worker"),t.terminate();return this.running=!1,this.emit("abort")},e.prototype.spawnWorkers=function(){var t;return t=Math.min(this.options.workers,this.frames.length),function(){var e;e=[];for(var i=this.freeWorkers.length;this.freeWorkers.length<=t?i<t:i>t;this.freeWorkers.length<=t?++i:--i)e.push(i);return e}.apply(this,arguments).forEach(function(t){return function(e){var i;return console.log("spawning worker "+e),(i=new Worker(t.options.workerScript)).onmessage=function(t){return function(e){return t.activeWorkers.splice(t.activeWorkers.indexOf(i),1),t.freeWorkers.push(i),t.frameFinished(e.data)}}(t),t.freeWorkers.push(i)}}(this)),t},e.prototype.frameFinished=function(t){return console.log("frame "+t.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[t.index]=t,function(t,e){for(var i=0,n=e.length;i<n;++i)if(i in e&&e[i]===t)return!0;return!1}(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},e.prototype.finishRendering=function(){var t,e,i,n,r,o,s;r=0;for(var a=0,h=this.imageParts.length;a<h;++a)r+=((e=this.imageParts[a]).data.length-1)*e.pageSize+e.cursor;r+=e.pageSize-e.cursor,console.log("rendering finished - filesize "+Math.round(r/1e3)+"kb"),t=new Uint8Array(r),o=0;for(var c=0,l=this.imageParts.length;c<l;++c)for(var u=0,p=(e=this.imageParts[c]).data.length;u<p;++u)s=e.data[u],i=u,t.set(s,o),i===e.data.length-1?o+=e.cursor:o+=e.pageSize;return n=new Blob([t],{type:"image/gif"}),this.emit("finished",n,t)},e.prototype.renderNextFrame=function(){var t,e,i;if(0===this.freeWorkers.length)throw new Error("No free workers");return this.nextFrame>=this.frames.length?void 0:(t=this.frames[this.nextFrame++],i=this.freeWorkers.shift(),e=this.getTask(t),console.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(i),i.postMessage(e))},e.prototype.getContextData=function(t){return t.getImageData(0,0,this.options.width,this.options.height).data},e.prototype.getImageData=function(t){var e;return null!=this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(e=this._canvas.getContext("2d")).setFill=this.options.background,e.fillRect(0,0,this.options.width,this.options.height),e.drawImage(t,0,0),this.getContextData(e)},e.prototype.getTask=function(t){var e,i;if(i={index:e=this.frames.indexOf(t),last:e===this.frames.length-1,delay:t.delay,transparent:t.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,repeat:this.options.repeat,canTransfer:"chrome"===s.name},null!=t.data)i.data=t.data;else if(null!=t.context)i.data=this.getContextData(t.context);else{if(null==t.image)throw new Error("Invalid frame");i.data=this.getImageData(t.image)}return i},e}(),t.exports=l}),e.define("/browser.coffee",function(t,e,i,n){var r,o,s,a,h;a=navigator.userAgent.toLowerCase(),s=navigator.platform.toLowerCase(),o="ie"===(h=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0])[1]&&document.documentMode,(r={name:"version"===h[1]?h[3]:h[1],version:o||parseFloat("opera"===h[1]&&h[4]?h[4]:h[2]),platform:{name:a.match(/ip(?:ad|od|hone)/)?"ios":(a.match(/(?:webos|android)/)||s.match(/mac|win|linux/)||["other"])[0]}})[r.name]=!0,r[r.name+parseInt(r.version,10)]=!0,r.platform[r.platform.name]=!0,t.exports=r}),e.define("events",function(t,e,n,r){i.EventEmitter||(i.EventEmitter=function(){});var o=e.EventEmitter=i.EventEmitter,s="function"==typeof Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};o.prototype.setMaxListeners=function(t){this._events||(this._events={}),this._events.maxListeners=t},o.prototype.emit=function(t){if("error"===t&&(!this._events||!this._events.error||s(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var e=this._events[t];if(!e)return!1;if("function"!=typeof e){if(s(e)){for(var i=Array.prototype.slice.call(arguments,1),n=e.slice(),r=0,o=n.length;r<o;r++)n[r].apply(this,i);return!0}return!1}switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1);e.apply(this,i)}return!0},o.prototype.addListener=function(t,e){if("function"!=typeof e)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",t,e),this._events[t])if(s(this._events[t])){var i;if(!this._events[t].warned)(i=void 0!==this._events.maxListeners?this._events.maxListeners:10)&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace());this._events[t].push(e)}else this._events[t]=[this._events[t],e];else this._events[t]=e;return this},o.prototype.on=o.prototype.addListener,o.prototype.once=function(t,e){var i=this;return i.on(t,function n(){i.removeListener(t,n),e.apply(this,arguments)}),this},o.prototype.removeListener=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[t])return this;var i=this._events[t];if(s(i)){var n=i.indexOf(e);if(n<0)return this;i.splice(n,1),0==i.length&&delete this._events[t]}else this._events[t]===e&&delete this._events[t];return this},o.prototype.removeAllListeners=function(t){return t&&this._events&&this._events[t]&&(this._events[t]=null),this},o.prototype.listeners=function(t){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),s(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]}}),t.GIF=e("/gif.coffee")}).call(this,this)},function(t,e){t.exports=function(t,e,i){var n,r,o,s=window,a="application/octet-stream",h=i||a,c=t,l=document,u=l.createElement("a"),p=function(t){return String(t)},d=s.Blob||s.MozBlob||s.WebKitBlob||p,f=s.MSBlobBuilder||s.WebKitBlobBuilder||s.BlobBuilder,m=e||"download";if("true"===String(this)&&(h=(c=[c,h])[0],c=c[1]),String(c).match(/^data\:[\w+\-]+\/[\w+\-]+[,;]/))return navigator.msSaveBlob?navigator.msSaveBlob(function(t){var e=t.split(/[:;,]/),i=e[1],n=("base64"==e[2]?atob:decodeURIComponent)(e.pop()),r=n.length,o=0,s=new Uint8Array(r);for(;o<r;++o)s[o]=n.charCodeAt(o);return new d([s],{type:i})}(c),m):g(c);try{n=c instanceof d?c:new d([c],{type:h})}catch(t){f&&((r=new f).append([c]),n=r.getBlob(h))}function g(t,e){if("download"in u)return u.href=t,u.setAttribute("download",m),u.innerHTML="downloading...",u.style.display="none",l.body.appendChild(u),setTimeout(function(){u.click(),l.body.removeChild(u),!0===e&&setTimeout(function(){s.URL.revokeObjectURL(u.href)},250)},66),!0;var i=l.createElement("iframe");l.body.appendChild(i),e||(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,a)),i.src=t,setTimeout(function(){l.body.removeChild(i)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(n,m);if(s.URL)g(s.URL.createObjectURL(n),!0);else{if("string"==typeof n||n.constructor===p)try{return g("data:"+h+";base64,"+s.btoa(n))}catch(t){return g("data:"+h+","+encodeURIComponent(n))}(o=new FileReader).onload=function(t){g(this.result)},o.readAsDataURL(n)}return!0}},function(t,e,i){window.download=i(5),window.GIF=i(4).GIF;var n=i(3);if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("camera-recorder",{dependencies:["camera"],schema:{dur:{default:3e3},enabled:{default:!0},framerate:{default:60},lookAt:{type:"vec3"},holdTimeAfter:{default:250},motionBlurEnabled:{default:!0},name:{default:""},quality:{default:10},positionFrom:{type:"vec3"},positionTo:{type:"vec3"},rotationFrom:{type:"vec3"},rotationTo:{type:"vec3"},showControls:{default:!0},workers:{default:8},workerPath:{default:"./"}},multiple:!0,init:function(){var t=this.data;this.startRecordingBound=(()=>{this.startRecording(!1)}),this.startPreviewingBound=(()=>{this.startRecording(!0)}),this.data.showControls&&(this.injectRecordButton(),this.injectDryRunButton()),this.capture=new n({format:"gif",name:t.name||void 0,motionBlurFrames:t.motionBlurEnabled?1:0,onProgress:t=>{this.el.emit("camerarecorderprogress",t,!1)},quality:t.quality,workers:t.workers,workersPath:t.workerPath}),this.lookAt=new THREE.Vector3,this.originalPosition=new THREE.Vector3,this.originalQuaternion=new THREE.Quaternion,this.originalCameraPosition=new THREE.Vector3,this.originalCameraQuaternion=new THREE.Quaternion},update:function(){var t,e=this.data,i=this.el;this.time=0,"positionTo"in(t=this.el.getDOMAttribute("camera-recorder"))&&i.setAttribute("animation__recorderposition",{property:"position",dur:e.dur,easing:"linear",from:"positionFrom"in t?e.positionFrom:i.getAttribute("position"),startEvents:"camerarecorderanimationstart",pauseEvents:"camerarecorderanimationstop",to:e.positionTo}),"rotationTo"in t&&i.setAttribute("animation__recorderrotation",{property:"rotation",dur:e.dur,easing:"linear",from:"rotationFrom"in t?e.rotationFrom:i.getAttribute("rotation"),startEvents:"camerarecorderanimationstart",pauseEvents:"camerarecorderanimationstop",to:e.rotationTo}),"lookAt"in t&&this.lookAt.copy(e.lookAt)},play:function(){var t=this.el;t.addEventListener("camerarecorderstart",this.startRecordingBound),t.addEventListener("camerarecorderdrystart",this.startPreviewingBound),t.hasAttribute("look-controls")&&t.getAttribute("look-controls").enabled&&(t.setAttribute("look-controls","enabled",!1),this.flippedLookControls=!0),t.hasAttribute("orbit-controls")&&t.getAttribute("orbit-controls").enabled&&(t.setAttribute("orbit-controls","enabled",!1),this.flippedOrbitControls=!0),this.resetPose()},remove:function(){var t=this.el;t.emit("camerarecorderanimationstop",null,!1),t.removeEventListener("camerarecorderstart",this.startRecordingBound),t.removeEventListener("camerarecorderdrystart",this.startPreviewingBound),this.flippedLookControls&&t.setAttribute("look-controls","enabled",!0),this.flippedOrbitControls&&t.setAttribute("orbit-controls","enabled",!0),setTimeout(()=>{t.object3D.position.copy(this.originalPosition),t.object3D.quaternion.copy(this.originalQuaternion),t.getObject3D("camera").position.copy(this.originalCameraPosition),t.getObject3D("camera").quaternion.copy(this.originalCameraQuaternion)})},tick:function(){(this.isRecording||this.isPreviewing)&&this.lookAt&&this.el.object3D.lookAt(this.lookAt)},tock:function(t,e){if(this.isRecording||this.isPreviewing){if(this.time+=e,this.time>this.data.dur+this.data.holdTimeAfter)return this.time=0,setTimeout(()=>{this.resetPose()},this.data.holdTimeAfter+100),this.isPreviewing?void(this.isPreviewing=!1):(this.isRecording=!1,this.capture.stop(),this.capture.save(),void(this.recordButton&&(this.recordButton.setAttribute("disabled",""),this.recordButton.innerHTML="Processing...")));this.isRecording&&this.capture.capture(this.el.sceneEl.canvas)}},resetPose:function(){this.originalPosition.copy(this.el.object3D.position),this.originalQuaternion.copy(this.el.object3D.quaternion),this.originalCameraPosition.copy(this.el.getObject3D("camera").position),this.originalCameraQuaternion.copy(this.el.getObject3D("camera").quaternion)},startRecording:function(t){this.el.emit("camerarecorderanimationstart"),this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),setTimeout(()=>{"lookAt"in this.el.getDOMAttribute("camera-recorder")&&(this.el.getObject3D("camera").rotation.y=Math.PI),t?this.isPreviewing=!0:(this.capture.start(),this.isRecording=!0)})},injectRecordButton:function(){var t;(t=document.createElement("button")).innerHTML="Start recording",t.style.left="5px",t.style.position="fixed",t.style.top="5px",t.style.zIndex=999999999999,document.body.appendChild(t),t.addEventListener("click",()=>{this.startRecording()}),this.recordButton=t},injectDryRunButton:function(){var t;(t=document.createElement("button")).innerHTML="Preview recording",t.style.left="5px",t.style.position="fixed",t.style.top="30px",t.style.zIndex=999999999999,document.body.appendChild(t),t.addEventListener("click",()=>{this.startRecording(!0)})}})},function(t,e,i){i(6),t.exports=i(0)}]);